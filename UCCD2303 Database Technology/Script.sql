DROP TABLE STAFF CASCADE CONSTRAINTS;
DROP TABLE STUDENT CASCADE CONSTRAINTS;
DROP TABLE MEMBER CASCADE CONSTRAINTS;
DROP TABLE BOOK CASCADE CONSTRAINTS;
DROP TABLE RESERVE CASCADE CONSTRAINTS;
DROP TABLE LEND CASCADE CONSTRAINTS;
DROP TABLE RENEW CASCADE CONSTRAINTS;

CREATE TABLE MEMBER(
M_ID VARCHAR2(6),
RegisterDate DATE,
AccType VARCHAR2(20),
TotalLending NUMBER(2),
CONSTRAINT MEMBER_PK PRIMARY KEY(M_ID)
);

CREATE TABLE STAFF(
M_ID VARCHAR2(6),
FName VARCHAR2(30),
LName VARCHAR2(30),
Gender VARCHAR2(10),
Age NUMBER(2),
Campus VARCHAR2(30),
ContactNo VARCHAR2(12),
Email VARCHAR2(30),
CONSTRAINT STAFF_PK PRIMARY KEY(M_ID),
CONSTRAINT STAFF_MEMBER_FK FOREIGN KEY(M_ID) REFERENCES MEMBER(M_ID)
);

CREATE TABLE STUDENT(
M_ID VARCHAR2(6),
FName VARCHAR2(30),
LName VARCHAR2(30),
Gender VARCHAR2(10),
Age NUMBER(2),
Campus VARCHAR2(30),
Course VARCHAR2(4),
ContactNo VARCHAR2(12),
Email VARCHAR2(30),
CONSTRAINT STUDENT_PK PRIMARY KEY(M_ID),
CONSTRAINT STUDENT_MEMBER_FK FOREIGN KEY(M_ID) REFERENCES MEMBER(M_ID)
);

CREATE TABLE BOOK(
B_ID VARCHAR2(6),
Category VARCHAR2(30),
Title VARCHAR2(60),
Publisher VARCHAR2(60),
Quantity NUMBER(4),
Campus VARCHAR2(30),
CONSTRAINT BOOK_PK PRIMARY KEY(B_ID)
);

CREATE TABLE RESERVE(
RS_ID VARCHAR2(7),
ReserveDate DATE,
M_ID VARCHAR2(6),
B_ID VARCHAR2(6),
CONSTRAINT RESERVE_PK PRIMARY KEY(RS_ID),
CONSTRAINT RESERVE_MEMBER_FK FOREIGN KEY(M_ID) REFERENCES MEMBER(M_ID),
CONSTRAINT RESERVE_BOOK_FK FOREIGN KEY(B_ID) REFERENCES BOOK(B_ID)
);

CREATE TABLE LEND(
L_ID VARCHAR2(6),
LendDate DATE,
DueDate DATE,
Status VARCHAR2(20),
PenaltyFees NUMBER(3),
M_ID VARCHAR2(6),
B_ID VARCHAR2(6),
CONSTRAINT LEND_PK PRIMARY KEY(L_ID),
CONSTRAINT LEND_MEMBER_FK FOREIGN KEY(M_ID) REFERENCES MEMBER(M_ID),
CONSTRAINT LEND_BOOK_FK FOREIGN KEY(B_ID) REFERENCES BOOK(B_ID)
);

CREATE TABLE RENEW(
RN_ID VARCHAR2(7),
RenewDate DATE,
DueDate DATE,
L_ID VARCHAR2(6),
CONSTRAINT RENEW_PK PRIMARY KEY(RN_ID),
CONSTRAINT RENEW_LEND_FK FOREIGN KEY(L_ID) REFERENCES LEND(L_ID)
);

INSERT INTO MEMBER (M_ID, RegisterDate, Acctype, TotalLending) VALUES ('M00001',TO_DATE('2022-01-01','YYYY-MM-DD'),'Staff',1);
INSERT INTO MEMBER (M_ID, RegisterDate, Acctype, TotalLending) VALUES ('M00002',TO_DATE('2022-02-02','YYYY-MM-DD'),'Student',0);
INSERT INTO MEMBER (M_ID, RegisterDate, Acctype, TotalLending) VALUES ('M00003',TO_DATE('2022-02-03','YYYY-MM-DD'),'Staff',1);
INSERT INTO MEMBER (M_ID, RegisterDate, Acctype, TotalLending) VALUES ('M00004',TO_DATE('2022-03-04','YYYY-MM-DD'),'Student',1);
INSERT INTO MEMBER (M_ID, RegisterDate, Acctype, TotalLending) VALUES ('M00005',TO_DATE('2022-03-05','YYYY-MM-DD'),'Staff',1);
INSERT INTO MEMBER (M_ID, RegisterDate, Acctype, TotalLending) VALUES ('M00006',TO_DATE('2022-04-11','YYYY-MM-DD'),'Student',0);
INSERT INTO MEMBER (M_ID, RegisterDate, Acctype, TotalLending) VALUES ('M00007',TO_DATE('2022-04-12','YYYY-MM-DD'),'Staff',0);
INSERT INTO MEMBER (M_ID, RegisterDate, Acctype, TotalLending) VALUES ('M00008',TO_DATE('2022-03-13','YYYY-MM-DD'),'Student',0);
INSERT INTO MEMBER (M_ID, RegisterDate, Acctype, TotalLending) VALUES ('M00009',TO_DATE('2022-02-14','YYYY-MM-DD'),'Staff',0);
INSERT INTO MEMBER (M_ID, RegisterDate, Acctype, TotalLending) VALUES ('M00010',TO_DATE('2022-01-15','YYYY-MM-DD'),'Student',0);

INSERT INTO STAFF (M_ID, FName, LName, Gender, Age, Campus, ContactNo, Email) VALUES ('M00001','Jenny','Klee','Female',26,'Kampar','01211245654','jennyk@gmail.com');
INSERT INTO STAFF (M_ID, FName, LName, Gender, Age, Campus, ContactNo, Email) VALUES ('M00003','Jean','Chan','Female',23,'Kampar','01214123421','jeanc@gmail.com');
INSERT INTO STAFF (M_ID, FName, LName, Gender, Age, Campus, ContactNo, Email) VALUES ('M00005','Mona','Tan','Female',22,'Sungai Long','01754234578','monat@gmail.com');
INSERT INTO STAFF (M_ID, FName, LName, Gender, Age, Campus, ContactNo, Email) VALUES ('M00007','Diluc','Lee','Male',24,'Kampar','01032152441','dilucl@gmail.com');
INSERT INTO STAFF (M_ID, FName, LName, Gender, Age, Campus, ContactNo, Email) VALUES ('M00009','Ayato','Kamisato','Male',25,'Kampar','0162245578','ayatok@gmail.com');

INSERT INTO STUDENT (M_ID, FName, LName, Gender, Age, Campus, Course, ContactNo, Email) VALUES ('M00002','Chris','Hanson','Male',20,'Sungai Long','CN','01077456538','chrhan@gmail.com');
INSERT INTO STUDENT (M_ID, FName, LName, Gender, Age, Campus, Course, ContactNo, Email) VALUES ('M00004','Ayaka','Kamisato','Female',21,'Kampar','CS','01122011572','ayakak@gmail.com');
INSERT INTO STUDENT (M_ID, FName, LName, Gender, Age, Campus, Course, ContactNo, Email) VALUES ('M00006','Baal','Raiden','Female',22,'Kampar','CT','01233699638','baalr@gmail.com');
INSERT INTO STUDENT (M_ID, FName, LName, Gender, Age, Campus, Course, ContactNo, Email) VALUES ('M00008','Itto','Arataki','Male',23,'Sungai Long','IA','01655447824','ittoa@gmail.com');
INSERT INTO STUDENT (M_ID, FName, LName, Gender, Age, Campus, Course, ContactNo, Email) VALUES ('M00010','Hu','Tao','Female',19,'Sungai Long','IB','01066699696','hutao@gmail.com');

INSERT INTO BOOK (B_ID, Category, Title, Publisher, Quantity, Campus) VALUES ('B00001','Biology','A Study on Stem Cell','PGO Sdn Bhd',4,'Sungai Long');
INSERT INTO BOOK (B_ID, Category, Title, Publisher, Quantity, Campus) VALUES ('B00002','Mathematic','A Study on Trigonometry','ASD Sdn Bhd',3,'Sungai Long');
INSERT INTO BOOK (B_ID, Category, Title, Publisher, Quantity, Campus) VALUES ('B00003','Chemistry','A Study on Lawrencium','KIY Sdn Bhd',2,'Sungai Long');
INSERT INTO BOOK (B_ID, Category, Title, Publisher, Quantity, Campus) VALUES ('B00004','Physic','A Study on Momentum','KUT Sdn Bhd',1,'Kampar');
INSERT INTO BOOK (B_ID, Category, Title, Publisher, Quantity, Campus) VALUES ('B00005','Computer Technology','A Study on Database','ICT Sdn Bhd',3,'Kampar');

INSERT INTO LEND (L_ID, LendDate, DueDate, Status, PenaltyFees, M_ID, B_ID) VALUES ('L00001',TO_DATE('2022-03-27','YYYY-MM-DD'),TO_DATE('2022-04-10','YYYY-MM-DD'),'Expired',5,'M00001','B00001');
INSERT INTO LEND (L_ID, LendDate, DueDate, Status, PenaltyFees, M_ID, B_ID) VALUES ('L00002',TO_DATE('2022-03-13','YYYY-MM-DD'),TO_DATE('2022-04-10','YYYY-MM-DD'),'Returned',null,'M00002','B00002');
INSERT INTO LEND (L_ID, LendDate, DueDate, Status, PenaltyFees, M_ID, B_ID) VALUES ('L00003',TO_DATE('2022-03-20','YYYY-MM-DD'),TO_DATE('2022-05-08','YYYY-MM-DD'),'Lending',null,'M00003','B00003');
INSERT INTO LEND (L_ID, LendDate, DueDate, Status, PenaltyFees, M_ID, B_ID) VALUES ('L00004',TO_DATE('2022-02-06','YYYY-MM-DD'),TO_DATE('2022-03-20','YYYY-MM-DD'),'Returned',null,'M00004','B00004');
INSERT INTO LEND (L_ID, LendDate, DueDate, Status, PenaltyFees, M_ID, B_ID) VALUES ('L00005',TO_DATE('2022-04-17','YYYY-MM-DD'),TO_DATE('2022-04-17','YYYY-MM-DD'),'Lending',null,'M00005','B00005');

INSERT INTO RESERVE (RS_ID, ReserveDate, M_ID, B_ID) VALUES ('RS00001',TO_DATE('2022-04-10','YYYY-MM-DD'),'M00001','B00002');
INSERT INTO RESERVE (RS_ID, ReserveDate, M_ID, B_ID) VALUES ('RS00002',TO_DATE('2022-05-08','YYYY-MM-DD'),'M00002','B00003');
INSERT INTO RESERVE (RS_ID, ReserveDate, M_ID, B_ID) VALUES ('RS00003',TO_DATE('2022-03-20','YYYY-MM-DD'),'M00003','B00004');
INSERT INTO RESERVE (RS_ID, ReserveDate, M_ID, B_ID) VALUES ('RS00004',TO_DATE('2022-04-17','YYYY-MM-DD'),'M00004','B00005');
INSERT INTO RESERVE (RS_ID, ReserveDate, M_ID, B_ID) VALUES ('RS00005',TO_DATE('2022-04-10','YYYY-MM-DD'),'M00005','B00001');

INSERT INTO RENEW (RN_ID, RenewDate, DueDate, L_ID) VALUES ('RN00001',TO_DATE('2022-03-27','YYYY-MM-DD'),TO_DATE('2022-04-10','YYYY-MM-DD'),'L00002');
INSERT INTO RENEW (RN_ID, RenewDate, DueDate, L_ID) VALUES ('RN00002',TO_DATE('2022-04-10','YYYY-MM-DD'),TO_DATE('2022-05-08','YYYY-MM-DD'),'L00003');
INSERT INTO RENEW (RN_ID, RenewDate, DueDate, L_ID) VALUES ('RN00003',TO_DATE('2022-02-20','YYYY-MM-DD'),TO_DATE('2022-03-06','YYYY-MM-DD'),'L00004');
INSERT INTO RENEW (RN_ID, RenewDate, DueDate, L_ID) VALUES ('RN00004',TO_DATE('2022-03-06','YYYY-MM-DD'),TO_DATE('2022-03-20','YYYY-MM-DD'),'L00004');
INSERT INTO RENEW (RN_ID, RenewDate, DueDate, L_ID) VALUES ('RN00005',TO_DATE('2022-03-20','YYYY-MM-DD'),TO_DATE('2022-04-17','YYYY-MM-DD'),'L00005');

DROP USER adminAcc CASCADE;
DROP USER managerAcc CASCADE;
DROP USER librarianAcc CASCADE;

CREATE USER adminAcc IDENTIFIED BY admin;
CREATE USER managerAcc IDENTIFIED BY manager;
CREATE USER librarianAcc IDENTIFIED BY librarian;

GRANT CREATE SESSION TO adminAcc;
GRANT CREATE SESSION TO managerAcc;
GRANT CREATE SESSION TO librarianAcc;

DROP ROLE Admin CASCADE;
DROP ROLE Manager CASCADE;
DROP ROLE Librarian CASCADE;

CREATE ROLE Admin;
CREATE ROLE Manager;
CREATE ROLE Librarian;

GRANT DBA TO Admin;

GRANT SELECT, INSERT, UPDATE, DELETE ON STAFF TO Manager;
GRANT SELECT, INSERT, UPDATE, DELETE ON STUDENT TO Manager;
GRANT SELECT, INSERT, UPDATE, DELETE ON MEMBER TO Manager;
GRANT SELECT, INSERT, UPDATE, DELETE ON BOOK TO Manager;
GRANT SELECT, INSERT, UPDATE, DELETE ON RESERVE TO Manager;
GRANT SELECT, INSERT, UPDATE, DELETE ON LEND TO Manager;
GRANT SELECT, INSERT, UPDATE, DELETE ON RENEW TO Manager;

GRANT SELECT ON STAFF TO Librarian;
GRANT SELECT ON STUDENT TO Librarian;
GRANT SELECT ON MEMBER TO Librarian;
GRANT SELECT, UPDATE ON BOOK TO Librarian;
GRANT SELECT, INSERT, DELETE ON RESERVE TO Librarian;
GRANT SELECT, INSERT, UPDATE ON LEND TO Librarian;
GRANT SELECT, INSERT, UPDATE ON RENEW TO Manager;

COMMIT;
